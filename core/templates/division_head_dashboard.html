{% extends 'base.html' %}

{% block title %}Division Head Dashboard - {{ division_head.name }}{% endblock %}

{% block extra_css %}
<style>
    .division-header {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        padding: 40px;
        border-radius: 12px;
        color: white;
        margin-bottom: 32px;
    }
    
    .division-header h1 {
        font-size: 32px;
        margin-bottom: 8px;
    }
    
    .division-header p {
        opacity: 0.9;
        font-size: 16px;
    }
    
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
        margin-bottom: 32px;
    }
    
    .summary-card {
        background: #fff;
        border: 1px solid #e9ecef;
        padding: 24px;
        border-radius: 8px;
    }
    
    .summary-card h3 {
        font-size: 28px;
        font-weight: 600;
        margin-bottom: 4px;
        color: #212529;
    }
    
    .summary-card p {
        font-size: 14px;
        color: #6c757d;
        font-weight: 500;
    }
    
    .summary-card.highlight {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border: none;
    }
    
    .summary-card.highlight h3,
    .summary-card.highlight p {
        color: white;
    }
    
    .risk-summary {
        display: flex;
        gap: 16px;
        align-items: center;
    }
    
    .risk-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .risk-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }
    
    .risk-dot.high { background: #c53030; }
    .risk-dot.medium { background: #d97706; }
    .risk-dot.low { background: #15803d; }
    
    .areas-section {
        margin-top: 32px;
    }
    
    .areas-section h2 {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 16px;
        color: #212529;
    }
    
    .areas-grid {
        display: grid;
        gap: 24px;
    }
    
    .area-card {
        background: #fff;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 24px;
        transition: all 0.2s;
    }
    
    .area-card:hover {
        border-color: #dee2e6;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .area-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #e9ecef;
    }
    
    .area-info h3 {
        font-size: 20px;
        font-weight: 600;
        color: #212529;
        margin-bottom: 4px;
    }
    
    .area-info p {
        font-size: 14px;
        color: #6c757d;
    }
    
    .area-metrics {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
        margin-bottom: 20px;
    }
    
    .area-metric {
        text-align: center;
        padding: 16px;
        background: #f8f9fa;
        border-radius: 6px;
    }
    
    .area-metric-value {
        font-size: 24px;
        font-weight: 600;
        color: #212529;
    }
    
    .area-metric-label {
        font-size: 12px;
        color: #6c757d;
        margin-top: 4px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .progress-bar {
        width: 100%;
        height: 10px;
        background: #e9ecef;
        border-radius: 5px;
        overflow: hidden;
        margin: 12px 0;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
        transition: width 0.3s ease;
    }
    
    .progress-label {
        font-size: 14px;
        color: #495057;
        font-weight: 500;
    }
    
    .risk-badges {
        display: flex;
        gap: 12px;
        margin-top: 16px;
    }
    
    .risk-badge-item {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
    }
    
    .risk-badge-item.high {
        background: #fff5f5;
        color: #c53030;
        border: 1px solid #fc8181;
    }
    
    .risk-badge-item.medium {
        background: #fffbeb;
        color: #d97706;
        border: 1px solid #fbbf24;
    }
    
    .risk-badge-item.low {
        background: #f0fdf4;
        color: #15803d;
        border: 1px solid #86efac;
    }
    
    .view-details-btn {
        display: inline-block;
        padding: 10px 20px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        text-decoration: none;
        border-radius: 6px;
        font-weight: 500;
        font-size: 14px;
        transition: all 0.2s;
    }
    
    .view-details-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
    }
</style>
{% endblock %}

{% block content %}
{% if error %}
    <div class="alert alert-error">
        <strong>Error:</strong> {{ error }}
    </div>
{% else %}
    <div class="division-header">
        <h1>{{ division_head.name }}</h1>
        <p>{{ division_head.division_name }} • {{ division_head.email }}</p>
    </div>
    
    <div class="summary-grid">
        <div class="summary-card highlight">
            <h3>{{ summary.total_areas }}</h3>
            <p>Areas</p>
        </div>
        <div class="summary-card">
            <h3>{{ summary.total_agents }}</h3>
            <p>Total Agents</p>
        </div>
        <div class="summary-card">
            <h3>₱{{ summary.total_sales|floatformat:0 }}</h3>
            <p>Total Sales</p>
        </div>
        <div class="summary-card">
            <h3>{{ summary.achievement_percentage|floatformat:1 }}%</h3>
            <p>Achievement</p>
        </div>
        <div class="summary-card">
            <h3>{{ summary.average_score|floatformat:1 }}%</h3>
            <p>Avg Score</p>
        </div>
    </div>
    
    <div class="summary-card">
        <p style="margin-bottom: 12px; font-weight: 600;">Division Risk Distribution</p>
        <div class="risk-summary">
            <div class="risk-item">
                <div class="risk-dot high"></div>
                <span>{{ summary.high_risk_count }} High Risk Agents</span>
            </div>
            <div class="risk-item">
                <div class="risk-dot medium"></div>
                <span>{{ summary.medium_risk_count }} Medium Risk Agents</span>
            </div>
            <div class="risk-item">
                <div class="risk-dot low"></div>
                <span>{{ summary.low_risk_count }} Low Risk Agents</span>
            </div>
        </div>
    </div>
    
    {% if areas %}
    <div class="areas-section">
        <h2>Area Performance Overview</h2>
        <div class="areas-grid">
            {% for area in areas %}
            <div class="area-card">
                <div class="area-header">
                    <div class="area-info">
                        <h3>{{ area.manager.name }}</h3>
                        <p>{{ area.manager.area_name }} • {{ area.summary.total_agents }} agents</p>
                    </div>
                    <a href="{% url 'area_manager_dashboard' area.manager_id %}" class="view-details-btn">View Details</a>
                </div>
                
                <div class="area-metrics">
                    <div class="area-metric">
                        <div class="area-metric-value">₱{{ area.summary.total_sales|floatformat:0 }}</div>
                        <div class="area-metric-label">Sales</div>
                    </div>
                    <div class="area-metric">
                        <div class="area-metric-value">₱{{ area.summary.total_target|floatformat:0 }}</div>
                        <div class="area-metric-label">Target</div>
                    </div>
                    <div class="area-metric">
                        <div class="area-metric-value">{{ area.summary.achievement_percentage|floatformat:1 }}%</div>
                        <div class="area-metric-label">Achievement</div>
                    </div>
                    <div class="area-metric">
                        <div class="area-metric-value">{{ area.summary.average_score|floatformat:1 }}%</div>
                        <div class="area-metric-label">Avg Score</div>
                    </div>
                </div>
                
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 14px; font-weight: 500; color: #495057;">Target Achievement</span>
                        <span style="font-size: 14px; font-weight: 600; color: #212529;">{{ area.summary.achievement_percentage|floatformat:1 }}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ area.summary.achievement_percentage|floatformat:0 }}%"></div>
                    </div>
                </div>
                
                <div class="risk-badges">
                    <div class="risk-badge-item high">{{ area.summary.high_risk_count }} High</div>
                    <div class="risk-badge-item medium">{{ area.summary.medium_risk_count }} Medium</div>
                    <div class="risk-badge-item low">{{ area.summary.low_risk_count }} Low</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
{% endif %}
{% endblock %}
