{% extends 'base.html' %}

{% block title %}Sales Agent Dashboard - SalesAI{% endblock %}

{% block content %}
<div class="agent-dashboard">
    <!-- Header Section -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1>üë§ My Performance Dashboard</h1>
            <p class="subtitle">Welcome, {{ user.name }}!</p>
            {% if agent %}
            <p class="agent-id">Agent ID: {{ agent._id }}</p>
            {% endif %}
        </div>
        <div class="header-actions">
            <a href="/logout/" class="btn btn-outline">
                <span class="icon">üö™</span> Logout
            </a>
        </div>
    </div>

    <!-- Performance Overview -->
    <div class="performance-card">
        <div class="performance-header">
            <h2>üìä Monthly Performance</h2>
            {% if predictions %}
            <span class="prediction-badge {{ predictions.risk_level|lower }}">
                {{ predictions.risk_level }} RISK
            </span>
            {% endif %}
        </div>
        
        {% if agent and performance %}
        <div class="performance-stats">
            <div class="main-stat">
                <span class="stat-label">Monthly Target</span>
                <span class="stat-value">‚Ç±{{ agent.monthly_target|floatformat:0 }}</span>
            </div>
            <div class="main-stat">
                <span class="stat-label">Current Sales</span>
                <span class="stat-value highlight">‚Ç±{{ performance.total_sales|floatformat:0 }}</span>
            </div>
            <div class="main-stat">
                <span class="stat-label">Achievement</span>
                <span class="stat-value achievement">{{ performance.achievement_rate|floatformat:1 }}%</span>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-header">
                <span>Target Progress</span>
                <span>{{ performance.achievement_rate|floatformat:1 }}%</span>
            </div>
            <div class="progress-bar-large">
                <div class="progress-fill-large" style="width: {{ performance.achievement_rate|default:0 }}%"></div>
            </div>
        </div>
        {% else %}
        <p class="no-data">No performance data available</p>
        {% endif %}
    </div>

    <!-- Quick Stats Grid -->
    <div class="stats-grid">
        {% if performance %}
        <div class="stat-card">
            <div class="stat-icon" style="background: #d1fae5;">üí∞</div>
            <div class="stat-content">
                <h3>{{ performance.total_sales_count|default:0 }}</h3>
                <p>Closed Sales</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #dbeafe;">üìä</div>
            <div class="stat-content">
                <h3>{{ performance.total_leads|default:0 }}</h3>
                <p>Active Leads</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #fef3c7;">üéØ</div>
            <div class="stat-content">
                <h3>{{ performance.conversion_rate|floatformat:1|default:"0" }}%</h3>
                <p>Conversion Rate</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #e0e7ff;">üìà</div>
            <div class="stat-content">
                <h3>‚Ç±{{ performance.avg_sale_amount|floatformat:0|default:"0" }}</h3>
                <p>Avg Sale Amount</p>
            </div>
        </div>
        {% else %}
        <div class="stat-card">
            <div class="stat-icon" style="background: #f3f4f6;">üìä</div>
            <div class="stat-content">
                <h3>-</h3>
                <p>No data</p>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- AI Predictions -->
    {% if predictions %}
    <div class="card prediction-card">
        <h2>ü§ñ AI Prediction & Insights</h2>
        <div class="prediction-content">
            <div class="prediction-status {{ predictions.risk_level|lower }}">
                <div class="status-icon">
                    {% if predictions.risk_level == 'HIGH' %}‚ö†Ô∏è
                    {% elif predictions.risk_level == 'MEDIUM' %}‚ö°
                    {% else %}‚úÖ{% endif %}
                </div>
                <div class="status-text">
                    <h3>{{ predictions.prediction }}</h3>
                    <p>Confidence: {{ predictions.confidence|floatformat:1 }}%</p>
                </div>
            </div>
            
            {% if predictions.recommendations %}
            <div class="recommendations">
                <h4>üí° Recommendations:</h4>
                <ul>
                    {% for rec in predictions.recommendations %}
                    <li>{{ rec }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Two Column Layout -->
    <div class="two-column-layout">
        <!-- Recent Sales -->
        <div class="card">
            <h2>üí∞ Recent Sales</h2>
            {% if performance.recent_sales %}
            <div class="sales-list">
                {% for sale in performance.recent_sales %}
                <div class="sale-item">
                    <div class="sale-icon">üíµ</div>
                    <div class="sale-details">
                        <p class="sale-amount">‚Ç±{{ sale.amount|floatformat:0 }}</p>
                        <p class="sale-date">{{ sale.date|date:"M d, Y" }}</p>
                        {% if sale.product_name %}
                        <p class="sale-product">{{ sale.product_name }}</p>
                        {% endif %}
                    </div>
                    <div class="sale-status">
                        <span class="badge-success">‚úì Closed</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="no-data">No recent sales</p>
            {% endif %}
        </div>

        <!-- Active Leads -->
        <div class="card">
            <h2>üìä Active Leads</h2>
            {% if performance.active_leads %}
            <div class="leads-list">
                {% for lead in performance.active_leads %}
                <div class="lead-item">
                    <div class="lead-info">
                        <p class="lead-name">{{ lead.customer_name }}</p>
                        <p class="lead-product">{{ lead.product_name }}</p>
                        <p class="lead-value">Est. Value: ‚Ç±{{ lead.estimated_value|floatformat:0 }}</p>
                    </div>
                    <div class="lead-status">
                        <span class="status-badge {{ lead.status|lower }}">{{ lead.status }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="no-data">No active leads</p>
            {% endif %}
        </div>
    </div>

    <!-- Performance Tips -->
    <div class="card tips-card">
        <h2>üí° Performance Tips</h2>
        <div class="tips-grid">
            <div class="tip-item">
                <div class="tip-icon">üéØ</div>
                <div class="tip-content">
                    <h4>Stay Consistent</h4>
                    <p>Make daily progress towards your target</p>
                </div>
            </div>
            <div class="tip-item">
                <div class="tip-icon">üìû</div>
                <div class="tip-content">
                    <h4>Follow Up</h4>
                    <p>Regular contact increases conversion rates</p>
                </div>
            </div>
            <div class="tip-item">
                <div class="tip-icon">üìö</div>
                <div class="tip-content">
                    <h4>Know Your Products</h4>
                    <p>Product knowledge builds customer confidence</p>
                </div>
            </div>
            <div class="tip-item">
                <div class="tip-icon">ü§ù</div>
                <div class="tip-content">
                    <h4>Build Relationships</h4>
                    <p>Long-term relationships drive sales</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .agent-dashboard {
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
    }

    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .header-content h1 {
        font-size: 2rem;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .subtitle {
        color: #6b7280;
        font-size: 1.1rem;
        margin-bottom: 0.25rem;
    }

    .agent-id {
        color: #667eea;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .header-actions {
        display: flex;
        gap: 1rem;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
    }

    .btn-outline {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
    }

    .btn-outline:hover {
        background: #667eea;
        color: white;
    }

    .performance-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .performance-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .performance-header h2 {
        color: white;
        font-size: 1.5rem;
    }

    .prediction-badge {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .prediction-badge.high { background: #fee2e2; color: #991b1b; }
    .prediction-badge.medium { background: #fed7aa; color: #92400e; }
    .prediction-badge.low { background: #d1fae5; color: #065f46; }

    .performance-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .main-stat {
        display: flex;
        flex-direction: column;
    }

    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 0.5rem;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: bold;
    }

    .stat-value.highlight {
        color: #fbbf24;
    }

    .stat-value.achievement {
        color: #34d399;
    }

    .progress-section {
        background: rgba(255, 255, 255, 0.1);
        padding: 1.5rem;
        border-radius: 8px;
    }

    .progress-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.75rem;
        font-weight: 600;
    }

    .progress-bar-large {
        height: 12px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 6px;
        overflow: hidden;
    }

    .progress-fill-large {
        height: 100%;
        background: white;
        transition: width 0.5s ease;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
    }

    .stat-content h3 {
        font-size: 1.8rem;
        color: #1f2937;
        margin-bottom: 0.25rem;
    }

    .stat-content p {
        color: #6b7280;
        font-size: 0.9rem;
    }

    .card {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    .card h2 {
        margin-bottom: 1.5rem;
        color: #1f2937;
    }

    .prediction-card {
        border: 2px solid #667eea;
    }

    .prediction-content {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .prediction-status {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        padding: 1.5rem;
        border-radius: 8px;
    }

    .prediction-status.high { background: #fee2e2; }
    .prediction-status.medium { background: #fed7aa; }
    .prediction-status.low { background: #d1fae5; }

    .status-icon {
        font-size: 3rem;
    }

    .status-text h3 {
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .status-text p {
        color: #6b7280;
    }

    .recommendations {
        background: #f9fafb;
        padding: 1.5rem;
        border-radius: 8px;
    }

    .recommendations h4 {
        color: #1f2937;
        margin-bottom: 1rem;
    }

    .recommendations ul {
        list-style: none;
        padding: 0;
    }

    .recommendations li {
        padding: 0.5rem 0;
        padding-left: 1.5rem;
        position: relative;
        color: #6b7280;
    }

    .recommendations li:before {
        content: "‚Üí";
        position: absolute;
        left: 0;
        color: #667eea;
        font-weight: bold;
    }

    .two-column-layout {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .sales-list, .leads-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .sale-item, .lead-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: #f9fafb;
        border-radius: 8px;
    }

    .sale-icon {
        font-size: 2rem;
    }

    .sale-details {
        flex: 1;
    }

    .sale-amount {
        font-weight: 600;
        color: #1f2937;
        font-size: 1.1rem;
        margin-bottom: 0.25rem;
    }

    .sale-date, .sale-product {
        color: #6b7280;
        font-size: 0.85rem;
    }

    .badge-success {
        background: #d1fae5;
        color: #065f46;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .lead-info {
        flex: 1;
    }

    .lead-name {
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.25rem;
    }

    .lead-product, .lead-value {
        color: #6b7280;
        font-size: 0.85rem;
    }

    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .status-badge.new { background: #dbeafe; color: #1e40af; }
    .status-badge.contacted { background: #e0e7ff; color: #3730a3; }
    .status-badge.qualified { background: #fef3c7; color: #92400e; }
    .status-badge.proposal { background: #fed7aa; color: #92400e; }
    .status-badge.negotiation { background: #fef3c7; color: #92400e; }

    .tips-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
    }

    .tip-item {
        display: flex;
        gap: 1rem;
        padding: 1.5rem;
        background: #f9fafb;
        border-radius: 8px;
    }

    .tip-icon {
        font-size: 2rem;
    }

    .tip-content h4 {
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .tip-content p {
        color: #6b7280;
        font-size: 0.9rem;
    }

    .no-data {
        text-align: center;
        color: #6b7280;
        padding: 2rem;
    }

    @media (max-width: 768px) {
        .agent-dashboard {
            padding: 1rem;
        }

        .dashboard-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .performance-stats {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .two-column-layout {
            grid-template-columns: 1fr;
        }

        .tips-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}
